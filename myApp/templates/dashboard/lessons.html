{% extends 'dashboard/base.html' %}

{% block title %}All Lessons{% endblock %}
{% block page_title %}All Lessons{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-6">
    <div>
        <h2 class="text-2xl font-bold mb-2">All Lessons</h2>
        <p class="text-gray-700">Manage lessons across all courses</p>
    </div>
    <div class="flex gap-3">
        <a href="{% url 'dashboard_upload_quiz' %}" class="px-6 py-3 bg-blue-soft text-white rounded-full font-bold hover:bg-blue-soft/90 transition-all">
            <i class="fas fa-upload mr-2"></i> Upload Quiz
        </a>
        <a href="{% url 'dashboard_add_lesson' %}" class="px-6 py-3 bg-teal-soft text-[#ffffff] rounded-full font-bold hover:bg-teal-soft/90 transition-all">
            <i class="fas fa-plus mr-2"></i> New Lesson
        </a>
    </div>
</div>

<!-- Filters -->
<div class="bg-[#ffffff]/60 backdrop-blur-sm border border-teal-soft/10 rounded-xl p-4 mb-6">
    <form method="GET" class="flex gap-4">
        <div class="flex-1">
            <select name="course" class="w-full bg-[#ffffff]/40 border border-teal-soft/20 rounded-lg px-4 py-2 focus:outline-none focus:border-teal-soft/50">
                <option value="">All Courses</option>
                {% for course in courses %}
                <option value="{{ course.id }}" {% if course_filter == course.id|stringformat:"s" %}selected{% endif %}>{{ course.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="flex-1">
            <select name="status" class="w-full bg-[#ffffff]/40 border border-teal-soft/20 rounded-lg px-4 py-2 focus:outline-none focus:border-teal-soft/50">
                <option value="all" {% if status_filter == 'all' %}selected{% endif %}>All Status</option>
                <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>Pending</option>
                <option value="generated" {% if status_filter == 'generated' %}selected{% endif %}>Generated</option>
                <option value="approved" {% if status_filter == 'approved' %}selected{% endif %}>Approved</option>
            </select>
        </div>
        <button type="submit" class="px-6 py-2 bg-teal-soft text-[#ffffff] rounded-lg font-semibold text-gray-700 hover:bg-teal-soft/90 transition-all">
            Filter
        </button>
    </form>
</div>

<!-- Lessons List -->
<div class="space-y-4">
    {% for lesson in lessons %}
    <div class="bg-[#ffffff]/60 backdrop-blur-sm border border-teal-soft/10 rounded-xl p-6 hover:border-teal-soft/30 transition-all">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-4 flex-1">
                {% if lesson.vimeo_thumbnail %}
                <img src="{{ lesson.vimeo_thumbnail }}" alt="{{ lesson.title }}" class="w-24 h-16 object-cover rounded">
                {% else %}
                <div class="w-24 h-16 bg-gradient-to-br from-teal-soft/20 to-blue-soft/20 rounded flex items-center justify-center">
                    <i class="fas fa-video text-teal-soft/50"></i>
                </div>
                {% endif %}
                <div class="flex-1">
                    <div class="font-bold text-lg mb-1">{{ lesson.title }}</div>
                    <div class="text-sm text-gray-700 flex items-center gap-4">
                        <span><i class="fas fa-book mr-1"></i> {{ lesson.course.name }}</span>
                        {% if lesson.module %}
                        <span><i class="fas fa-folder mr-1"></i> {{ lesson.module.name }}</span>
                        {% endif %}
                        <span><i class="fas fa-clock mr-1"></i> {{ lesson.get_formatted_duration }}</span>
                    </div>
                </div>
                <span class="px-3 py-1 rounded-full text-xs font-semibold text-gray-700
                    {% if lesson.ai_generation_status == 'approved' %}bg-green-500/20 text-green-400 border border-green-500/30
                    {% elif lesson.ai_generation_status == 'generated' %}bg-yellow-500/20 text-yellow-400 border border-yellow-500/30
                    {% else %}bg-gray-500/20 text-gray-700 border border-gray-500/30{% endif %}">
                    {{ lesson.get_ai_generation_status_display }}
                </span>
            </div>
            <div class="ml-4 flex flex-col gap-2 items-end">
                <div class="flex gap-2">
                    <a href="{% url 'dashboard_edit_lesson' lesson.id %}" class="px-4 py-2 bg-teal-soft/10 border border-teal-soft/30 rounded-lg font-medium hover:bg-teal-soft/20 transition-all text-sm">
                        Edit
                    </a>
                    <form method="POST" action="{% url 'dashboard_delete_lesson' lesson.id %}" class="inline" onsubmit="return confirm('Are you sure you want to delete \"{{ lesson.title }}\"? This will also delete all related progress, quiz data, and other associated information. This action cannot be undone.');">
                        {% csrf_token %}
                        <button type="submit" class="px-4 py-2 bg-red-500/10 border border-red-500/30 rounded-lg font-medium hover:bg-red-500/20 transition-all text-sm text-red-400">
                            <i class="fas fa-trash"></i>
                        </button>
                    </form>
                </div>
                <a href="{% url 'dashboard_lesson_quiz' lesson.id %}" class="px-4 py-2 bg-blue-soft/10 border border-blue-soft/30 rounded-lg font-medium hover:bg-blue-soft/20 transition-all text-xs text-blue-soft">
                    Manage Quiz
                </a>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="bg-[#ffffff]/60 backdrop-blur-sm border border-teal-soft/10 rounded-xl p-12 text-center">
        <i class="fas fa-video text-6xl text-gray-600 mb-4"></i>
        <p class="text-gray-700 text-lg mb-6">No lessons found. Create your first lesson!</p>
        <a href="{% url 'dashboard_add_lesson' %}" class="inline-block px-6 py-3 bg-teal-soft text-[#ffffff] rounded-full font-bold hover:bg-teal-soft/90 transition-all">
            <i class="fas fa-plus mr-2"></i> Add Lesson
        </a>
    </div>
    {% endfor %}
</div>
{% endblock %}

