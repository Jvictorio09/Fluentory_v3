{% extends 'dashboard/base.html' %}

{% block title %}Edit Bundle{% endblock %}
{% block page_title %}Edit Bundle{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="mb-6">
        <a href="{% url 'dashboard_bundles' %}" class="text-blue-soft hover:text-blue-soft/80 text-sm mb-4 inline-block">
            <i class="fas fa-arrow-left mr-2"></i> Back to Bundles
        </a>
    </div>

    <div class="bg-[#ffffff]/60 backdrop-blur-sm border border-blue-soft/10 rounded-xl p-8">
        <h2 class="text-2xl font-bold mb-6 text-black">Edit Bundle: {{ bundle.name }}</h2>
        <form method="POST">
            {% csrf_token %}
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Bundle Name *</label>
                    <input type="text" name="name" value="{{ bundle.name }}" required class="w-full bg-[#ffffff]/40 border border-blue-soft/20 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-soft/50 text-gray-800 placeholder-gray-500" placeholder="e.g., Black Friday 2025 Bundle">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Description</label>
                    <textarea name="description" rows="4" class="w-full bg-[#ffffff]/40 border border-blue-soft/20 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-soft/50 resize-none text-gray-800 placeholder-gray-500" placeholder="Describe what's included in this bundle...">{{ bundle.description }}</textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Bundle Type *</label>
                        <select name="bundle_type" required class="w-full bg-[#ffffff]/40 border border-blue-soft/20 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-soft/50 text-gray-800">
                            <option value="fixed" {% if bundle.bundle_type == 'fixed' %}selected{% endif %} class="text-gray-800">Fixed Bundle (curated set)</option>
                            <option value="pick_your_own" {% if bundle.bundle_type == 'pick_your_own' %}selected{% endif %} class="text-gray-800">Pick Your Own (choose N courses)</option>
                            <option value="tiered" {% if bundle.bundle_type == 'tiered' %}selected{% endif %} class="text-gray-800">Tiered (Bronze/Silver/Gold)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Price (optional)</label>
                        <input type="number" name="price" step="0.01" min="0" value="{{ bundle.price|default:'' }}" class="w-full bg-[#ffffff]/40 border border-blue-soft/20 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-soft/50 text-gray-800 placeholder-gray-500" placeholder="0.00">
                    </div>
                </div>
                
                <div id="max-selections-field" style="display: {% if bundle.bundle_type == 'pick_your_own' %}block{% else %}none{% endif %};">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Max Course Selections</label>
                    <input type="number" name="max_course_selections" min="1" value="{{ bundle.max_course_selections|default:'' }}" class="w-full bg-[#ffffff]/40 border border-blue-soft/20 rounded-lg px-4 py-3 focus:outline-none focus:border-blue-soft/50 text-gray-800 placeholder-gray-500" placeholder="Number of courses student can choose">
                    <p class="text-xs text-gray-600 mt-1">Only required for "Pick Your Own" bundles</p>
                </div>
                
                <div>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" name="is_active" {% if bundle.is_active %}checked{% endif %} class="rounded border-blue-soft/30 text-blue-soft focus:ring-blue-soft">
                        <span class="text-sm font-semibold text-gray-700">Active (bundle is available for purchase)</span>
                    </label>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Select Courses *</label>
                    <div class="bg-[#ffffff]/40 border border-blue-soft/20 rounded-lg p-4 max-h-64 overflow-y-auto">
                        <div class="space-y-2">
                            {% for course in courses %}
                            <label class="flex items-center gap-2 cursor-pointer hover:bg-blue-soft/5 p-2 rounded">
                                <input type="checkbox" name="courses" value="{{ course.id }}" {% if course.id in selected_course_ids %}checked{% endif %} class="rounded border-blue-soft/30 text-blue-soft focus:ring-blue-soft">
                                <span class="text-sm text-gray-800">{{ course.name }}</span>
                            </label>
                            {% empty %}
                            <p class="text-sm text-gray-600">No active courses available.</p>
                            {% endfor %}
                        </div>
                    </div>
                    <p class="text-xs text-gray-600 mt-2">Select which courses are included in this bundle</p>
                </div>
                
                <div class="flex gap-4 pt-4">
                    <button type="submit" class="flex-1 px-6 py-3 bg-gradient-to-r from-blue-soft to-teal-soft text-white rounded-full font-bold hover:from-blue-soft/90 hover:to-teal-soft/90 transition-all">
                        Update Bundle
                    </button>
                    <a href="{% url 'dashboard_bundles' %}" class="px-6 py-3 border border-blue-soft/30 rounded-full font-medium hover:bg-blue-soft/10 transition-all text-center text-gray-800">
                        Cancel
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    // Show/hide max course selections field based on bundle type
    document.querySelector('select[name="bundle_type"]').addEventListener('change', function() {
        const maxSelectionsField = document.getElementById('max-selections-field');
        if (this.value === 'pick_your_own') {
            maxSelectionsField.style.display = 'block';
        } else {
            maxSelectionsField.style.display = 'none';
        }
    });
</script>

<style>
    /* Make placeholders more visible */
    input::placeholder,
    textarea::placeholder {
        color: #6b7280 !important;
        opacity: 1 !important;
    }
    
    input::-webkit-input-placeholder,
    textarea::-webkit-input-placeholder {
        color: #6b7280 !important;
        opacity: 1 !important;
    }
    
    input::-moz-placeholder,
    textarea::-moz-placeholder {
        color: #6b7280 !important;
        opacity: 1 !important;
    }
    
    input:-ms-input-placeholder,
    textarea:-ms-input-placeholder {
        color: #6b7280 !important;
        opacity: 1 !important;
    }
    
    /* Ensure inputs and selects have visible text */
    input[type="text"],
    input[type="number"],
    textarea {
        color: #1f2937 !important;
        background-color: rgba(255, 255, 255, 0.6) !important;
    }
    
    select {
        color: #1f2937 !important;
        background-color: rgba(255, 255, 255, 0.6) !important;
    }
    
    select option {
        color: #1f2937 !important;
        background-color: white !important;
    }
</style>
{% endblock %}








