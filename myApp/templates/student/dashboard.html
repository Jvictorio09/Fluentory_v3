{% extends 'base.html' %}
{% load static %}

{% block title %}My Dashboard - Fluentory{% endblock %}

{% block content %}
<div class="space-y-10">

  <!-- HERO HEADER (modern, airy, brand-aligned) -->
  <section class="relative overflow-hidden rounded-3xl border border-slate-200/70 bg-white/70 shadow-soft backdrop-blur-xl">
    <!-- subtle atmosphere -->
    <div class="pointer-events-none absolute inset-0">
      <div class="absolute -top-40 left-1/2 h-[520px] w-[520px] -translate-x-1/2 rounded-full bg-gradient-to-br from-teal-soft/20 to-blue-soft/20 blur-3xl"></div>
      <div class="absolute -bottom-44 right-[-140px] h-[560px] w-[560px] rounded-full bg-gradient-to-tr from-blue-soft/14 to-teal-soft/14 blur-3xl"></div>
      <div class="absolute inset-0 opacity-[0.08]"
           style="background-image: linear-gradient(rgba(15,23,42,0.06) 1px, transparent 1px), linear-gradient(90deg, rgba(15,23,42,0.06) 1px, transparent 1px);
                  background-size: 56px 56px;">
      </div>
    </div>

    <div class="relative p-6 sm:p-8 md:p-10">
      <div class="flex flex-col gap-6 md:flex-row md:items-end md:justify-between">

        <div class="max-w-2xl">
          <p class="text-[11px] font-semibold text-gray-700 tracking-[0.34em] uppercase text-slate-500">
            Dashboard
          </p>
          <h1 class="mt-3 text-3xl md:text-4xl font-extrabold tracking-tight text-ink-deep">
            Your learning — at a glance
          </h1>
          <p class="mt-3 text-sm text-black md:text-base text-slate-600">
            Track progress, continue where you left off, and access your certificates.
          </p>

          <!-- micro trust line -->
          <div class="mt-5 flex flex-wrap items-center gap-x-5 gap-y-2 text-[11px] text-slate-500">
            <span class="inline-flex items-center gap-2">
              <i class="fas fa-infinity text-blue-soft"></i> Lifetime access
            </span>
            <span class="inline-flex items-center gap-2">
              <i class="fas fa-download text-black"></i> PDFs + audio
            </span>
            <span class="inline-flex items-center gap-2">
              <i class="fas fa-shield-check text-black"></i> 30-day guarantee
            </span>
          </div>
        </div>

        <div class="flex flex-wrap items-center gap-3">
          <a href="{% url 'student_certifications' %}"
             class="inline-flex items-center justify-center rounded-2xl bg-coral-cta px-5 py-3 text-sm text-black font-extrabold text-white shadow-lg shadow-coral-cta/25 transition hover:-translate-y-0.5">
            <i class="fas fa-certificate mr-2"></i>
            View certifications
          </a>

          <a href="{% url 'courses' %}"
             class="inline-flex items-center justify-center rounded-2xl border border-slate-200 bg-white/80 px-5 py-3 text-sm text-black font-semibold text-gray-700 text-ink-deep backdrop-blur transition hover:bg-white">
            <i class="fas fa-compass mr-2 text-blue-soft"></i>
            Browse courses
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- STATS (clean, product-like cards) -->
  <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
    <div class="rounded-3xl border border-slate-200/70 bg-white/80 p-6 shadow-sm shadow-slate-900/5 backdrop-blur">
      <div class="flex items-center justify-between">
        <div class="h-11 w-11 rounded-2xl bg-teal-soft/10 flex items-center justify-center">
          <i class="fas fa-book text-black"></i>
        </div>
        <span class="text-[11px] font-semibold text-gray-700 tracking-[0.22em] uppercase text-slate-400">Enrolled</span>
      </div>
      <div class="mt-4 text-3xl font-extrabold text-ink-deep">{{ total_courses }}</div>
      <p class="mt-1 text-sm text-black text-slate-600">Courses</p>
    </div>

    <div class="rounded-3xl border border-slate-200/70 bg-white/80 p-6 shadow-sm shadow-slate-900/5 backdrop-blur">
      <div class="flex items-center justify-between">
        <div class="h-11 w-11 rounded-2xl bg-success-soft/10 flex items-center justify-center">
          <i class="fas fa-check-circle text-success-soft"></i>
        </div>
        <span class="text-[11px] font-semibold text-gray-700 tracking-[0.22em] uppercase text-slate-400">Completed</span>
      </div>
      <div class="mt-4 text-3xl font-extrabold text-ink-deep">{{ completed_courses }}</div>
      <p class="mt-1 text-sm text-black text-slate-600">Courses</p>
    </div>

    <div class="rounded-3xl border border-slate-200/70 bg-white/80 p-6 shadow-sm shadow-slate-900/5 backdrop-blur">
      <div class="flex items-center justify-between">
        <div class="h-11 w-11 rounded-2xl bg-blue-soft/10 flex items-center justify-center">
          <i class="fas fa-layer-group text-blue-soft"></i>
        </div>
        <span class="text-[11px] font-semibold text-gray-700 tracking-[0.22em] uppercase text-slate-400">Lessons</span>
      </div>
      <div class="mt-4 text-3xl font-extrabold text-ink-deep">{{ completed_lessons_all }}<span class="text-slate-400">/</span>{{ total_lessons_all }}</div>
      <p class="mt-1 text-sm text-black text-slate-600">Completed</p>
    </div>

    <div class="rounded-3xl border border-slate-200/70 bg-white/80 p-6 shadow-sm shadow-slate-900/5 backdrop-blur">
      <div class="flex items-center justify-between">
        <div class="h-11 w-11 rounded-2xl bg-coral-cta/10 flex items-center justify-center">
          <i class="fas fa-chart-line text-coral-cta"></i>
        </div>
        <span class="text-[11px] font-semibold text-gray-700 tracking-[0.22em] uppercase text-slate-400">Overall</span>
      </div>
      <div class="mt-4 text-3xl font-extrabold text-ink-deep">{{ overall_progress }}%</div>
      <p class="mt-1 text-sm text-black text-slate-600">Progress</p>
    </div>
  </section>

  <!-- OVERALL PROGRESS (modern bar + number) -->
  <section class="rounded-3xl border border-slate-200/70 bg-white/80 p-6 md:p-7 shadow-sm shadow-slate-900/5 backdrop-blur">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-sm text-black font-semibold text-gray-700 text-ink-deep">Overall learning progress</p>
        <p class="mt-1 text-[12px] text-slate-500">A roll-up of your course completion.</p>
      </div>
      <div class="inline-flex items-center gap-2 rounded-full bg-blue-soft/10 px-4 py-1.5 text-sm text-black font-extrabold text-blue-soft">
        <i class="fas fa-sparkles text-[12px]"></i>
        {{ overall_progress }}%
      </div>
    </div>

    <div class="mt-5 h-3 w-full overflow-hidden rounded-full bg-slate-200">
      <div class="h-full rounded-full bg-gradient-to-r from-teal-soft to-blue-soft transition-all duration-500"
           style="width: {{ overall_progress }}%"></div>
    </div>
  </section>

  <!-- MY COURSES -->
  <section class="space-y-5">
    <div class="flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
      <div>
        <h2 class="text-2xl md:text-3xl font-extrabold tracking-tight text-ink-deep">My courses</h2>
        <p class="mt-1 text-sm text-black text-slate-600">Pick up right where you left off.</p>
      </div>

      <!-- Controls (chips + select, modern style) -->
      <div class="flex flex-wrap items-center gap-3">
        <a href="?favorites=true&sort={{ sort_by }}"
           class="inline-flex items-center gap-2 rounded-full border px-4 py-2 text-sm text-black font-semibold text-gray-700 transition
           {% if filter_favorites == 'true' %}
             border-amber-200 bg-amber-50 text-amber-700
           {% else %}
             border-slate-200 bg-white/80 text-slate-700 hover:bg-white
           {% endif %}">
          <i class="fas fa-heart"></i> Favorites
        </a>

        <a href="?sort={{ sort_by }}"
           class="inline-flex items-center gap-2 rounded-full border px-4 py-2 text-sm text-black font-semibold text-gray-700 transition
           {% if filter_favorites != 'true' %}
             border-blue-soft/30 bg-blue-soft/10 text-blue-soft
           {% else %}
             border-slate-200 bg-white/80 text-slate-700 hover:bg-white
           {% endif %}">
          <i class="fas fa-layer-group"></i> All
        </a>

        <div class="relative">
          <i class="fas fa-sort-amount-down absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs"></i>
          <select id="sortSelect"
                  onchange="window.location.href='?sort=' + this.value + '&favorites={{ filter_favorites }}'"
                  class="appearance-none rounded-full border border-slate-200 bg-white/80 py-2 pl-9 pr-9 text-sm text-black font-semibold text-gray-700 text-slate-700 backdrop-blur transition hover:bg-white focus:outline-none focus:ring-2 focus:ring-teal-soft/20">
            <option value="progress" {% if sort_by == 'progress' %}selected{% endif %}>Sort: Progress</option>
            <option value="favorites" {% if sort_by == 'favorites' %}selected{% endif %}>Sort: Favorites</option>
            <option value="name" {% if sort_by == 'name' %}selected{% endif %}>Sort: Name</option>
          </select>
          <i class="fas fa-chevron-down pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs"></i>
        </div>
      </div>
    </div>

    {% if my_courses %}
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-5">
        {% for data in my_courses %}
          <article class="group relative rounded-3xl border border-slate-200/70 bg-white/80 p-6 shadow-sm shadow-slate-900/5 backdrop-blur transition hover:-translate-y-0.5 hover:border-slate-300
                          {% if data.is_favorited %} ring-2 ring-amber-200 {% endif %}">

            <!-- top row -->
            <div class="flex items-start justify-between gap-4">
              <div class="min-w-0">
                <div class="flex items-center gap-3">
                  <h3 class="text-lg md:text-xl font-extrabold text-ink-deep truncate">
                    {{ data.course.name }}
                  </h3>

                  <!-- Favorite -->
                  <button onclick="toggleFavorite({{ data.course.id }}, this)"
                          class="favorite-btn inline-flex h-10 w-10 items-center justify-center rounded-full border border-slate-200 bg-white/70 transition hover:bg-white hover:scale-[1.02]
                                {% if data.is_favorited %} text-amber-600 {% else %} text-slate-400 hover:text-amber-600 {% endif %}"
                          data-course-id="{{ data.course.id }}"
                          data-is-favorited="{{ data.is_favorited|yesno:'true,false' }}"
                          aria-label="Toggle favorite">
                    <i class="fa-heart {% if data.is_favorited %}fas{% else %}far{% endif %}"></i>
                  </button>
                </div>

                <p class="mt-2 text-sm text-black text-slate-600">
                  {{ data.course.short_description|truncatewords:20 }}
                </p>
              </div>

              <!-- progress badge -->
              <div class="shrink-0 inline-flex items-center gap-2 rounded-full bg-teal-soft/10 px-4 py-1.5 text-sm text-black font-extrabold text-black">
                <i class="fas fa-chart-line text-[12px]"></i>
                {{ data.progress_percentage }}%
              </div>
            </div>

            <!-- progress bar -->
            <div class="mt-5">
              <div class="flex items-center justify-between text-[12px] text-slate-500">
                <span>Course progress</span>
                <span>{{ data.completed_lessons }}/{{ data.total_lessons }} lessons</span>
              </div>

              <div class="mt-2 h-2.5 w-full overflow-hidden rounded-full bg-slate-200">
                <div class="h-full rounded-full bg-gradient-to-r from-teal-soft to-blue-soft transition-all duration-500"
                     style="width: {{ data.progress_percentage }}%"></div>
              </div>

              <div class="mt-3 flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-black text-slate-600">
                {% if data.avg_watch_percentage > 0 %}
                  <span class="inline-flex items-center gap-2">
                    <i class="fas fa-eye text-blue-soft"></i>
                    {{ data.avg_watch_percentage }}% avg watch
                  </span>
                {% endif %}

                {% if data.access_record and data.access_record.expires_at %}
                  <span class="inline-flex items-center gap-2 text-amber-700">
                    <i class="fas fa-clock"></i>
                    Expires {{ data.access_record.expires_at|date:"M d, Y" }}
                  </span>
                {% endif %}
              </div>
            </div>

            <!-- status chips -->
            <div class="mt-5 flex flex-wrap gap-2">
              {% if data.exam_info.exists %}
                {% if data.exam_info.passed %}
                  <span class="inline-flex items-center gap-2 rounded-full border border-emerald-200 bg-emerald-50 px-3 py-1 text-xs font-semibold text-gray-700 text-emerald-700">
                    <i class="fas fa-check"></i> Exam passed
                  </span>
                {% elif data.exam_info.is_available %}
                  <span class="inline-flex items-center gap-2 rounded-full border border-amber-200 bg-amber-50 px-3 py-1 text-xs font-semibold text-gray-700 text-amber-700">
                    <i class="fas fa-clock"></i> Exam available
                  </span>
                {% endif %}
              {% endif %}

              {% if data.certification %}
                {% if data.cert_status == 'passed' %}
                  <span class="inline-flex items-center gap-2 rounded-full border border-amber-200 bg-amber-50 px-3 py-1 text-xs font-semibold text-gray-700 text-amber-700">
                    <i class="fas fa-certificate"></i> Certified
                  </span>
                {% elif data.cert_status == 'eligible' %}
                  <span class="inline-flex items-center gap-2 rounded-full border border-blue-soft/25 bg-blue-soft/10 px-3 py-1 text-xs font-semibold text-gray-700 text-blue-soft">
                    <i class="fas fa-certificate"></i> Eligible
                  </span>
                {% endif %}
              {% endif %}
            </div>

            <!-- actions -->
            <div class="mt-6 flex items-center gap-3">
              {% if data.has_any_progress %}
                <a href="{% url 'student_course_progress' data.course.slug %}"
                   class="flex-1 inline-flex items-center justify-center rounded-2xl border border-slate-200 bg-white/70 px-4 py-2.5 text-sm text-black font-semibold text-gray-700 text-ink-deep transition hover:bg-white">
                  View progress
                </a>

                {% if data.course.lessons.first %}
                  <a href="{% url 'lesson_detail' data.course.slug data.course.lessons.first.slug %}"
                     class="inline-flex items-center justify-center rounded-2xl bg-coral-cta px-4 py-2.5 text-sm text-black font-extrabold text-white shadow-lg shadow-coral-cta/20 transition hover:-translate-y-0.5">
                    Continue
                    <i class="fas fa-arrow-right ml-2 text-xs"></i>
                  </a>
                {% endif %}
              {% else %}
                {% if data.course.lessons.first %}
                  <a href="{% url 'lesson_detail' data.course.slug data.course.lessons.first.slug %}"
                     class="flex-1 inline-flex items-center justify-center rounded-2xl bg-coral-cta px-4 py-2.5 text-sm text-black font-extrabold text-white shadow-lg shadow-coral-cta/20 transition hover:-translate-y-0.5">
                    Start course
                    <i class="fas fa-arrow-right ml-2 text-xs"></i>
                  </a>
                {% else %}
                  <a href="{% url 'student_course_progress' data.course.slug %}"
                     class="flex-1 inline-flex items-center justify-center rounded-2xl border border-slate-200 bg-white/70 px-4 py-2.5 text-sm text-black font-semibold text-gray-700 text-ink-deep transition hover:bg-white">
                    View details
                  </a>
                {% endif %}
              {% endif %}
            </div>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <div class="rounded-3xl border border-slate-200/70 bg-white/80 p-12 text-center shadow-sm shadow-slate-900/5 backdrop-blur">
        <div class="mx-auto flex h-16 w-16 items-center justify-center rounded-3xl bg-blue-soft/10">
          <i class="fas fa-book-open text-2xl text-blue-soft"></i>
        </div>
        <h3 class="mt-5 text-xl font-extrabold text-ink-deep">No courses yet</h3>
        <p class="mt-2 text-sm text-black text-slate-600">
          You don’t have access to any courses yet. Browse the catalog or contact support.
        </p>
        <div class="mt-6">
          <a href="{% url 'courses' %}"
             class="inline-flex items-center justify-center rounded-2xl bg-coral-cta px-5 py-3 text-sm text-black font-extrabold text-white shadow-lg shadow-coral-cta/20 transition hover:-translate-y-0.5">
            Browse courses
            <i class="fas fa-arrow-right ml-2 text-xs"></i>
          </a>
        </div>
      </div>
    {% endif %}
  </section>

  <!-- AVAILABLE TO UNLOCK (same modern card language) -->
  {% if available_to_unlock %}
    <section class="space-y-5">
      <div>
        <h2 class="text-2xl md:text-3xl font-extrabold tracking-tight text-ink-deep">Available to unlock</h2>
        <p class="mt-1 text-sm text-black text-slate-600">Courses you can access via bundles, purchase, or after prerequisites.</p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-5">
        {% for data in available_to_unlock %}
          <article class="rounded-3xl border border-amber-200/70 bg-amber-50/60 p-6 shadow-sm shadow-slate-900/5 backdrop-blur transition hover:-translate-y-0.5 hover:border-amber-200">
            <div class="flex items-start justify-between gap-4">
              <div class="min-w-0 flex-1">
                <h3 class="text-lg md:text-xl font-extrabold text-ink-deep truncate">{{ data.course.name }}</h3>
                <p class="mt-2 text-sm text-black text-slate-700">
                  {{ data.course.short_description|truncatewords:20 }}
                </p>
              </div>
              <span class="shrink-0 inline-flex items-center gap-2 rounded-full border border-amber-200 bg-white/70 px-3 py-1 text-xs font-extrabold text-amber-700">
                <i class="fas fa-unlock"></i> Available
              </span>
            </div>

            <!-- Price Display for Paid Courses -->
            {% if data.course.is_paid and data.course.price %}
              <div class="mt-4 rounded-2xl border border-teal-soft/30 bg-teal-soft/10 p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-[11px] font-semibold text-gray-700 tracking-[0.18em] uppercase text-teal-soft/80 mb-1">Course Price</p>
                    <p class="text-2xl font-extrabold text-ink-deep">
                      {{ data.course.price|floatformat:2 }} {{ data.course.currency }}
                    </p>
                    <p class="text-xs text-slate-600 mt-1">One-time payment • Lifetime access</p>
                  </div>
                  <div class="text-right">
                    {% if data.has_pending_purchase %}
                      <span class="inline-flex items-center gap-2 rounded-full bg-amber-100 border border-amber-300 px-3 py-1 text-xs font-semibold text-amber-800">
                        <i class="fas fa-clock"></i> Purchase Pending
                      </span>
                    {% else %}
                      <a href="{% url 'course_detail' data.course.slug %}" 
                         class="inline-flex items-center justify-center rounded-2xl bg-coral-cta px-4 py-2.5 text-sm text-black font-extrabold text-white shadow-lg shadow-coral-cta/20 transition hover:-translate-y-0.5">
                        Buy Now
                        <i class="fas fa-arrow-right ml-2 text-xs"></i>
                      </a>
                    {% endif %}
                  </div>
                </div>
              </div>
            {% endif %}

            {% if data.bundles %}
              <div class="mt-4 rounded-2xl border border-amber-200/60 bg-white/60 p-4">
                <p class="text-[11px] font-semibold text-gray-700 tracking-[0.18em] uppercase text-amber-700/80">Available in bundles</p>
                <div class="mt-3 space-y-2 text-sm text-black">
                  {% for bundle in data.bundles %}
                    <div class="flex items-center justify-between gap-3">
                      <div class="min-w-0 text-slate-800">
                        <i class="fas fa-gift mr-2 text-amber-700"></i>
                        <span class="font-semibold text-gray-700">{{ bundle.name }}</span>
                      </div>
                      {% if bundle.price %}
                        <span class="text-slate-600">${{ bundle.price }}</span>
                      {% endif %}
                    </div>
                  {% endfor %}
                </div>
              </div>
            {% endif %}

            {% if not data.prereqs_met %}
              <div class="mt-4 rounded-2xl border border-amber-200/60 bg-white/60 p-4">
                <p class="text-xs font-extrabold text-amber-800 mb-2">
                  <i class="fas fa-lock mr-2"></i>Prerequisites required
                </p>
                <ul class="text-sm text-black text-slate-700 space-y-1">
                  {% for prereq in data.missing_prereqs %}
                    <li class="flex items-start gap-2">
                      <i class="fas fa-circle-minus text-amber-700 mt-1 text-xs"></i>
                      <span>{{ prereq.name }}</span>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            {% endif %}

            <div class="mt-5 flex items-center gap-3">
              <a href="{% url 'course_detail' data.course.slug %}"
                 class="flex-1 inline-flex items-center justify-center rounded-2xl border border-amber-200 bg-white/70 px-4 py-2.5 text-sm text-black font-semibold text-gray-700 text-amber-800 transition hover:bg-white">
                View details
              </a>
              {% if data.bundles %}
                <a href="{% url 'courses' %}"
                   class="inline-flex items-center justify-center rounded-2xl bg-coral-cta px-4 py-2.5 text-sm text-black font-extrabold text-white shadow-lg shadow-coral-cta/20 transition hover:-translate-y-0.5">
                  View bundles
                  <i class="fas fa-arrow-right ml-2 text-xs"></i>
                </a>
              {% elif not data.course.is_paid %}
                <a href="{% url 'courses' %}"
                   class="inline-flex items-center justify-center rounded-2xl bg-coral-cta px-4 py-2.5 text-sm text-black font-extrabold text-white shadow-lg shadow-coral-cta/20 transition hover:-translate-y-0.5">
                  Browse all
                  <i class="fas fa-arrow-right ml-2 text-xs"></i>
                </a>
              {% endif %}
            </div>
          </article>
        {% endfor %}
      </div>
    </section>
  {% endif %}
</div>

<script>
function toggleFavorite(courseId, buttonElement) {
  const icon = buttonElement.querySelector('i');
  const isCurrentlyFavorited = buttonElement.dataset.isFavorited === 'true';

  // Find card
  const card = buttonElement.closest('article');

  // Optimistic
  if (isCurrentlyFavorited) {
    icon.classList.remove('fas'); icon.classList.add('far');
    buttonElement.classList.remove('text-amber-600');
    buttonElement.classList.add('text-slate-400');
    if (card) card.classList.remove('ring-2','ring-amber-200');
  } else {
    icon.classList.remove('far'); icon.classList.add('fas');
    buttonElement.classList.remove('text-slate-400');
    buttonElement.classList.add('text-amber-600');
    if (card) card.classList.add('ring-2','ring-amber-200');
  }
  buttonElement.dataset.isFavorited = (!isCurrentlyFavorited).toString();

  // Spinner
  const originalClass = icon.className;
  icon.className = 'fas fa-spinner fa-spin text-amber-600';

  fetch(`/api/courses/${courseId}/favorite/`, {
    method: 'POST',
    headers: {
      'X-CSRFToken': getCookie('csrftoken'),
      'Content-Type': 'application/json',
    },
  })
  .then(r => r.json())
  .then(data => {
    if (data.success) {
      icon.className = data.is_favorited ? 'fas fa-heart' : 'far fa-heart';
      buttonElement.dataset.isFavorited = data.is_favorited.toString();
      if (data.is_favorited) {
        buttonElement.classList.remove('text-slate-400');
        buttonElement.classList.add('text-amber-600');
        if (card) card.classList.add('ring-2','ring-amber-200');
      } else {
        buttonElement.classList.remove('text-amber-600');
        buttonElement.classList.add('text-slate-400');
        if (card) card.classList.remove('ring-2','ring-amber-200');
      }
    } else {
      icon.className = originalClass;
      buttonElement.dataset.isFavorited = isCurrentlyFavorited.toString();
      alert('Error: ' + (data.message || 'Failed to update favorite'));
    }
  })
  .catch(() => {
    icon.className = originalClass;
    buttonElement.dataset.isFavorited = isCurrentlyFavorited.toString();
    alert('Error updating favorite. Please try again.');
  });
}

function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}
</script>
{% endblock %}
